# OSRM SERVER
This repository provide node binding to the OSRM binding.
See thee OSRM package on NPM form more information (https://www.npmjs.com/package/osrm)

It is based on [Open Source Routing Machine (OSRM)](https://project-osrm.org)
and [Express](http://expressjs.com/).

The service currently expose are
- Table (Matrix)
- Route (Direction)

This services are exposed over HTTP POST because of the limitation of GET request.

## OSRM Response
The default response structure from OSRM has been kept. See the OSRM Project documentation for more information

## Run the server
- ### Graph File
Add the part to thee graph file in the `.env` file. See the `.env.example`
You can as well update the path in the `server.js` file of each profile


## Requirements
- NodeJS
- Docker

## Setup - Building the containers

* the main application: `docker build -t osrm-server -f Dockerfile.nodejs .`
* osmium-tool for data manipulation: `docker build -t osmium-tool -f Dockerfile.osmium-tool .`

## Data preprocessing

In order to run this application a routable graph generated by OSRM is required.
OSRM itself can build a graph from various sources, in the following OpenStreetMap (OSM)
data is used.

### Get OSM data for your region of interest

Download the region you are interested in (e.g. Europe) from [Geofabrik](http://download.geofabrik.de/) or similar
sources and save the result in the home folder folder `data/`

    curl --create-dirs --output ~/osrm_data/<name-of-file>.osm.pbf http://download.geofabrik.de/europe-latest.osm.pbf



### Create a routable graph

Once we have our dataset, we can pass it to the OSRM container to create a routable graph with a given profile (car, foot, bike, ...)
with the contraction hierachies algorithm:

    # extract the network and create the osrm file(s)
    docker run -it -v $(pwd)/data:/data osrm/osrm-backend:v5.24.1 osrm-extract -p /opt/car.lua /data/osrm/example-areas/example-areas.osm.pbf

    # create the graph
    docker run -it -v $(pwd)/data:/data osrm/osrm-backend:v5.24.1 osrm-contract /data/osrm/example-areas/example-areas.osrm

The dataset is now available at `./data/osrm/example-areas` and can be used by any OSRM instance running the same version.

## Starting the server

In order to launch the application with the specified dataset (see above), run
the container with the required environment variables, port mapping and volume bindings:

    docker run --env-file .env -d -p 6000:6000 -p 6100:6100 -p 6200:6200 -v $(pwd)/data:/data osrm-express-server

After the application has loaded the graph in memory, you can make requests to the server running at:

- Drive [http://localhost:6000](http://localhost:6000)
- Bike [http://localhost:6100](http://localhost:6100)
- Foot [http://localhost:6200](http://localhost:6200)

## API Endpoints

This example application has 3 different endpoints

* `[GET || POST] /health`: A simple ping endpoint to check that the server is running.

* `POST /route`: Implements calls to `osrm.route` to calculate the way from A to B.

  _Example body_:
  ```
    { coordinates: [[13.3905, 52.5205], [13.3906, 52.5206]] }
  ```

* `POST /table`: Implements calls to `osrm.table` to get a travel times matrix for all provided locations.

  _Example body_:
  ```
    { coordinates: [[13.3905, 52.5205], [13.3906, 52.5206]] }
  ```

The source code should be simple enough to provide an overview and to get started for
extensions / own development.
